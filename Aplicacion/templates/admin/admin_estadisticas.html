{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estad칤sticas - Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Estilos -->
    <link rel="stylesheet" href="{% static 'css/admins/viewsadmin.css'%}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    {% include 'html/partials/navbar.html' %}

    <main class="admin-panel">
        <section class="bienvenida">
            <h1>游늵 Estad칤sticas de la Plataforma</h1>
            <p>Visualizaci칩n de la actividad reciente de usuarios y rutas.</p>
        </section>

        <section class="charts-container" style="display: flex; flex-wrap: wrap; gap: 40px; justify-content: center; padding: 2rem;">
            <!-- Usuarios por d칤a -->
            <div style="flex: 1; min-width: 400px;">
                <h2 style="text-align: center;">Usuarios activos (칰ltimos 7 d칤as)</h2>
                <canvas id="graficaUsuarios"></canvas>
            </div>

            <!-- Rutas m치s populares -->
            <div style="flex: 1; min-width: 400px;">
                <h2 style="text-align: center;">Top 5 rutas m치s vistas</h2>
                <canvas id="graficaRutas"></canvas>
            </div>
        </section>
    </main>

    <!-- Bloques JSON seguros -->
    {{ fechas|json_script:"fechas-data" }}
    {{ usuarios_por_dia|json_script:"usuarios-data" }}
    {{ rutas_nombres|json_script:"rutas-nombres" }}
    {{ rutas_vistas|json_script:"rutas-vistas" }}

    <!-- Script que consume los datos -->
    <script>
        const fechas = JSON.parse(document.getElementById('fechas-data').textContent);
        const usuarios = JSON.parse(document.getElementById('usuarios-data').textContent);
        const rutas = JSON.parse(document.getElementById('rutas-nombres').textContent);
        const vistas = JSON.parse(document.getElementById('rutas-vistas').textContent);

        // Usuarios activos
        new Chart(document.getElementById('graficaUsuarios'), {
            type: 'line',
            data: {
                labels: fechas,
                datasets: [{
                    label: 'Usuarios activos',
                    data: usuarios,
                    borderColor: '#00ff37',
                    backgroundColor: 'rgba(0,255,55,0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' }
                }
            }
        });

        // Rutas m치s vistas
        new Chart(document.getElementById('graficaRutas'), {
            type: 'bar',
            data: {
                labels: rutas,
                datasets: [{
                    label: 'Vistas',
                    data: vistas,
                    backgroundColor: 'rgba(0, 123, 255, 0.7)',
                    borderColor: '#007bff',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y',
                plugins: {
                    legend: { display: false }
                }
            }
        });
    </script>
</body>
</html>
